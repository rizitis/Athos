Packager="Anagnostakis Ioannis <rizitis@gmail.com> GR"

Homepage="https://kde.org/plasma-desktop/"
        #|--------------------------------------|#
SortDesc="KDE Plasma Workspace"
LongDesc="KDE Plasma Workspace"
VERSION=6.2.3
PRGNAM=plasma-workspace
SRCNAM=plasma-workspace
# Source download link
SRCURL=https://download.kde.org/stable/plasma/6.2.3/plasma-workspace-6.2.3.tar.xz
COMPRESS=tar.xz

REQUIRED=(extra-cmake-modules	kded	kdoctools	libxtst	xdotool	baloo	breeze	eudev	gpsd	icu	iso-codes	karchive	kauth	kcmutils	kcoreaddons	kcrash	kdbusaddons	kdeclarative	kded	kglobalaccel	kglobalacceld	kguiaddons	kholidays	ki18n	kiconthemes	kidletime	kio	kitemmodels	knewstuff	knotifications	knotifyconfig	kpackage	kparts	kpipewire	kquickcharts	krunner	kscreenlocker	kstatusnotifieritem	ksvg	ktexteditor	ktextwidgets	kunitconversion	kuserfeedback	kwayland	kwin	layer-shell-qt	libcanberra	libkexiv2	libkscreen	libksysguard	libplasma	libqalculate	networkmanager-qt	phonon	plasma-activities-stats	plasma-wayland-protocols	plasma5support	prison	qcoro	wayland	wayland-protocols	zlib)
OPTDEPS=

BUILD=${BUILD:-1}
TAG=${TAG:-_rtz}


# This must be always here even if not patches needed.
patch_build() {
if [ -e $CWD/patches/ ]; then
  for PATCH in $CWD/patches/*.patch; do
    patch -p1 -i $PATCH
  done
fi
}


slackbuild() {
CFLAGS="$CFLAGS -O2 -g1" CXXFLAGS="$CXXFLAGS -O2 -g1" \
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
-DCMAKE_INSTALL_DOCDIR=/usr/doc \ 
-DCMAKE_INSTALL_MANDIR=/usr/man \ 
		-DCMAKE_INSTALL_LIBDIR=lib64 \
		-DPLASMA_X11_DEFAULT_SESSION=OFF

ninja -C build shell/qwayland-plasma-shell.h
ninja -C build shell/wayland-plasma-shell-client-protocol.h
cmake --build build
DESTDIR="$PKG" cmake --install build

rm -r "$PKG"/usr/lib/systemd

	if [ -d "$PKG"/home ]; then
		rm -r "${PKG:?}"/home
	fi

}
